services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:9.1.5
    environment:
      # å•èŠ‚ç‚¹æ¨¡å¼é…ç½®
      - discovery.type=single-node
      # å†…å­˜é…ç½®
      - "ES_JAVA_OPTS=-Xms1g -Xmx1g"
      # å®‰å…¨é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒï¼Œç¦ç”¨å®‰å…¨è®¤è¯ï¼‰
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    volumes:
      - es-data:/usr/share/elasticsearch/data  # å¯é€‰ï¼šæ•°æ®æŒä¹…åŒ–
    command: >
      bash -c "
        # æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…
        if ! elasticsearch-plugin list | grep -q analysis-ik; then
          echo 'ğŸ”§ å®‰è£…IKæ’ä»¶...'
          elasticsearch-plugin install --batch https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-9.1.5.zip
          echo 'âœ… IKæ’ä»¶å®‰è£…å®Œæˆ'
        fi
        # å¯åŠ¨ES
        /usr/local/bin/docker-entrypoint.sh
      "

volumes:
  es-data:
    driver: local